# 핸드오프 - 2026-01-21 Phase 4

> Phase 4: Image Generation 완료 | 다음: Phase 5 또는 의존성 설치

---

## 빌드 상태

| 검증 | 결과 | 비고 |
|------|------|------|
| 타입 체크 | ⚠️ 의존성 필요 | shadcn/ui, @google/generative-ai 설치 필요 |
| 빌드 | ⏳ 의존성 설치 후 확인 |  |
| 린트 | ⏳ 의존성 설치 후 확인 |  |

---

## 완료된 Phase

### Phase 4: Image Generation ✅ (10/10 Contracts)

#### Contracts 완료 목록

| Contract | 파일 | 상태 |
|----------|------|------|
| IMAGE_FUNC_GENERATE | `lib/imageProvider/generate.ts` | ✅ |
| IMAGE_FUNC_PROVIDER | `lib/imageProvider/selectProvider.ts` | ✅ |
| IMAGE_FUNC_UPSCALE | `lib/imageProvider/upscale.ts` | ✅ |
| IMAGE_FUNC_SAVE | `lib/storage/uploadImage.ts` | ✅ |
| IMAGE_FUNC_LIST | `lib/images/list.ts` | ✅ |
| IMAGE_FUNC_DELETE | `lib/images/delete.ts` | ✅ |
| IMAGE_DESIGN_RESULT | `app/(main)/result/page.tsx` | ✅ |
| IMAGE_DESIGN_GALLERY | `app/(main)/gallery/page.tsx` | ✅ |
| IMAGE_DESIGN_PROGRESS | `components/generate/ProgressOverlay.tsx` | ✅ |
| IMAGE_DESIGN_LAZY | `components/ui/LazyImage.tsx` | ✅ |

#### 구현된 파일 목록

```
lib/imageProvider/
├── types.ts              # 타입 정의
├── googleGenAI.ts        # Google GenAI 연동
├── openRouter.ts         # OpenRouter 연동
├── selectProvider.ts     # 프로바이더 선택 로직
├── generate.ts           # 통합 생성 함수
├── upscale.ts            # 업스케일 기능
└── index.ts              # 모듈 export

lib/storage/
├── uploadImage.ts        # Supabase Storage 업로드
└── index.ts              # 모듈 export

lib/images/
├── list.ts               # 갤러리 목록
├── delete.ts             # 삭제 (soft delete)
└── index.ts              # 모듈 export

app/api/
├── generate/route.ts     # 생성 API
├── upscale/route.ts      # 업스케일 API
└── images/
    ├── list/route.ts     # 목록 API
    ├── save/route.ts     # 저장 API
    ├── search/route.ts   # 검색 API
    ├── trash/route.ts    # 휴지통 API
    └── [id]/route.ts     # 단일 이미지 CRUD

app/(main)/
├── result/page.tsx       # 결과 페이지
└── gallery/page.tsx      # 갤러리 페이지

components/
├── generate/
│   └── ProgressOverlay.tsx  # 진행률 오버레이
└── ui/
    └── LazyImage.tsx        # 지연 로딩 이미지
```

---

## 필수 설치 의존성

### 1. shadcn/ui 컴포넌트 (필수)

```bash
# shadcn/ui 초기화 (이미 완료된 경우 스킵)
npx shadcn@latest init

# 필수 컴포넌트 설치
npx shadcn@latest add button card dialog dropdown-menu input progress select skeleton
```

### 2. AI Provider SDK (필수)

```bash
npm install @google/generative-ai
```

### 3. Supabase Storage (이미 설치된 경우 스킵)

```bash
npm install @supabase/supabase-js
```

---

## 환경 변수 설정

```env
# AI Providers (필수)
GOOGLE_AI_API_KEY=your_google_ai_key
OPENROUTER_API_KEY=your_openrouter_key

# Supabase Storage (기존 설정 사용)
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

---

## Supabase Storage 버킷 설정

Supabase Dashboard에서 실행:

```sql
-- 이미지 버킷 생성
INSERT INTO storage.buckets (id, name, public)
VALUES ('images', 'images', true)
ON CONFLICT (id) DO NOTHING;

-- 썸네일 버킷 생성
INSERT INTO storage.buckets (id, name, public)
VALUES ('thumbnails', 'thumbnails', true)
ON CONFLICT (id) DO NOTHING;

-- RLS 정책 설정 (예시)
CREATE POLICY "Users can upload own images"
ON storage.objects FOR INSERT
WITH CHECK (bucket_id IN ('images', 'thumbnails') AND auth.uid()::text = (storage.foldername(name))[1]);

CREATE POLICY "Public read access"
ON storage.objects FOR SELECT
USING (bucket_id IN ('images', 'thumbnails'));
```

---

## 빌드 확인 절차

의존성 설치 후:

```bash
# 1. 타입 체크
npx tsc --noEmit

# 2. 린트
npm run lint

# 3. 빌드
npm run build
```

---

## 미해결 이슈

### UI 컴포넌트 타입 오류

shadcn/ui 컴포넌트 설치 후 자동 해결됨:
- `@/components/ui/button`
- `@/components/ui/card`
- `@/components/ui/dialog`
- `@/components/ui/dropdown-menu`
- `@/components/ui/input`
- `@/components/ui/progress`
- `@/components/ui/select`
- `@/components/ui/skeleton`

### Event Handler 타입

컴포넌트 설치 후 자동 해결됨 (React event types)

---

## 다음 작업 (Phase 5: Hybrid Processing)

### Contract 목록 (10개)

| Contract | 파일 |
|----------|------|
| HYBRID_FUNC_BG_REMOVE | `lib/imageProcessing/removeBackground.ts` |
| HYBRID_FUNC_COLOR_TRANSFER | `lib/imageProcessing/colorTransfer.ts` |
| HYBRID_FUNC_FILTER | `lib/imageProcessing/applyFilter.ts` |
| HYBRID_FUNC_COLOR_EXTRACT | `lib/imageProcessing/extractColor.ts` |
| HYBRID_FUNC_SAM | `lib/imageProcessing/segmentAnything.ts` |
| HYBRID_FUNC_COLORWAY | `lib/imageProcessing/colorway.ts` |
| HYBRID_DESIGN_STUDIO | `app/(main)/color-correction/page.tsx` |
| HYBRID_DESIGN_FILTER_TAB | `components/studio/FilterTab.tsx` |
| HYBRID_DESIGN_TRANSFER_TAB | `components/studio/ColorTransferTab.tsx` |
| HYBRID_DESIGN_BG_REMOVE_TAB | `components/studio/BackgroundRemovalTab.tsx` |

### 필요 의존성

```bash
npm install @imgly/background-removal @xenova/transformers
```

---

## 세션 재개 방법

```bash
# 1. 의존성 설치
npm install @google/generative-ai
npx shadcn@latest add button card dialog dropdown-menu input progress select skeleton

# 2. 환경 변수 확인
# .env.local에 GOOGLE_AI_API_KEY, OPENROUTER_API_KEY 설정

# 3. 빌드 확인
npm run build

# 4. /clear 실행 후 새 세션에서:
"Phase 5 시작해줘"
```

---

> **작성자**: Claude Code
> **Phase 4 완료 시점**: 2026-01-21
