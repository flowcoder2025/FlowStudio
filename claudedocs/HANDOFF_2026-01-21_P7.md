# 핸드오프 - 2026-01-21 Phase 7

## 빌드 상태
- 타입 체크: ✅
- 빌드: ✅
- 린트: ✅ (경고만 존재, 에러 없음)

## 완료된 Phase
- **Phase 7: Workflow Guide System** ✅ (12/12 Contracts)

### Phase 7a: 의도 체계 (4개) ✅
| Contract | 파일 | 설명 |
|----------|------|------|
| INTENT_TAXONOMY | `lib/workflow/intents/taxonomy.ts` | 계층형 의도 분류 체계 (35개 의도) |
| INTENT_MATRIX | `lib/workflow/intents/matrix.ts` | 업종×의도 호환성 매트릭스 |
| INTENT_MATCHER | `lib/workflow/intents/matcher.ts` | 자연어 → 의도 매칭 |
| API_INTENT_ANALYZE | `app/api/workflows/intent/route.ts` | 의도 분석 API |

### Phase 7b: 추천 시스템 (3개) ✅
| Contract | 파일 | 설명 |
|----------|------|------|
| RECOMMEND_SCORING | `lib/workflow/recommend/scoring.ts` | 스코어링 로직 (5가지 요소) |
| RECOMMEND_ENGINE | `lib/workflow/recommend/engine.ts` | 자동 추천 엔진 |
| (index) | `lib/workflow/recommend/index.ts` | 모듈 인덱스 |

### Phase 7c: 유연한 가이드 + 이미지 첨부 (5개) ✅
| Contract | 파일 | 설명 |
|----------|------|------|
| GUIDE_DYNAMIC | `lib/workflow/guide/dynamic.ts` | 동적 단계 생성기 (13개 단계 타입) |
| GUIDE_BRANCHING | `lib/workflow/guide/branching.ts` | 분기/스킵 로직 |
| (index) | `lib/workflow/guide/index.ts` | 모듈 인덱스 |
| API_GUIDE_STEPS | `app/api/workflows/guide/route.ts` | 가이드 API |

## 구현된 핵심 기능

### 1. 계층형 의도 분류
```
Layer 1: 촬영 목적 (WHY) - 5개
├── ecommerce, brand-building, social-marketing, catalog, detail-page

Layer 2: 표현 방식 (HOW) - 35개
├── with-person (6개): model-fullbody, model-halfbody, hand-holding, hand-using, lifestyle-casual, lifestyle-premium
├── product-only (6개): hero-front, hero-angle, flat-lay, ghost-mannequin, floating, multi-angle
├── detail-focus (5개): texture, function, ingredient, close-up, cross-section
├── mood-styling (11개): seasonal-spring/summer/fall/winter, color-warm/cool/pastel/vivid, space-minimal/cozy/luxury
└── composition (5개): color-variation, set-bundle, size-comparison, before-after, group-shot

Layer 3: 세부 요소 (WHAT)
├── background (10개), lighting (8개), angle (8개), props (7개)
```

### 2. 자동 추천 시스템
- **스코어링 요소**: intentSimilarity(35%), industryRelevance(30%), popularityScore(15%), userHistory(15%), recency(5%)
- **트리거 타입**: always, low-confidence, ambiguous, user-request
- **크로스 인더스트리 추천**: 업종 간 유사 워크플로우 자동 제안

### 3. 유연한 단계 가이드
- **동적 단계 생성**: 의도에 따라 3~8단계 자동 구성
- **분기 로직**: 사용자 선택에 따라 단계 추가/제거/수정
- **스킵 지원**: 선택적 단계 스킵 가능 (auto-skip, show-collapsed, ask-confirmation)
- **이미지 첨부**: reference-image 단계에서 참조 이미지 업로드 지원

### 4. API 엔드포인트
```
POST /api/workflows/intent    - 자연어 의도 분석
GET  /api/workflows/intent    - 의도/카테고리 목록 조회
POST /api/workflows/guide     - 가이드 생성/업데이트
GET  /api/workflows/guide     - 가이드 미리보기/조회
```

## 생성된 파일 목록
```
lib/workflow/
├── intents/
│   ├── taxonomy.ts    (530줄) - 의도 분류 체계
│   ├── matrix.ts      (280줄) - 업종×의도 매핑
│   ├── matcher.ts     (350줄) - 매칭 알고리즘
│   └── index.ts       (50줄)  - 인덱스
├── recommend/
│   ├── scoring.ts     (230줄) - 스코어링 로직
│   ├── engine.ts      (350줄) - 추천 엔진
│   └── index.ts       (30줄)  - 인덱스
└── guide/
    ├── dynamic.ts     (780줄) - 동적 가이드 생성
    ├── branching.ts   (560줄) - 분기/스킵 로직
    └── index.ts       (30줄)  - 인덱스

app/api/workflows/
├── intent/route.ts    (170줄) - 의도 분석 API
└── guide/route.ts     (200줄) - 가이드 API
```

## 다음 작업 (Phase 8 - UI 컴포넌트)
구현된 백엔드 로직을 활용하는 프론트엔드 컴포넌트 구현 필요:

| 컴포넌트 | 설명 |
|----------|------|
| `components/workflow/GuideChat.tsx` | 대화형 가이드 UI |
| `components/workflow/RecommendCard.tsx` | 추천 카드 UI |
| `components/workflow/StepFlow.tsx` | 유연한 단계 표시 |
| `components/workflow/ImageUpload.tsx` | 참조 이미지 업로드 |
| `components/workflow/SimilarWorkflows.tsx` | 크로스 인더스트리 추천 UI |

## 미해결 이슈
- 없음

## 필요 환경 설정
- 기존 환경 그대로 사용 가능

## 사용 예시

### 의도 분석 API
```typescript
// POST /api/workflows/intent
const response = await fetch('/api/workflows/intent', {
  method: 'POST',
  body: JSON.stringify({ text: '빵 사진 찍고 싶어요' })
});
// Returns: { industry: 'food', expression: 'product-only.hero-front', recommendations: [...] }
```

### 가이드 생성 API
```typescript
// POST /api/workflows/guide
const response = await fetch('/api/workflows/guide', {
  method: 'POST',
  body: JSON.stringify({
    intent: 'with-person.model-fullbody',
    industry: 'fashion'
  })
});
// Returns: { guide: {...}, meta: { progress: 0, nextStep: {...} } }
```

---

> **마지막 업데이트**: 2026-01-21 Phase 7 완료
